FROM python:3.12-slim

ARG VERSION=0.31.6

LABEL maintainer="W S <34316639+msaad00@users.noreply.github.com>"
LABEL description="agent-bom MCP Server: AI supply chain security scanning via MCP protocol"
LABEL org.opencontainers.image.version="${VERSION}"
LABEL org.opencontainers.image.source="https://github.com/msaad00/agent-bom"
LABEL io.modelcontextprotocol.server.name="io.github.msaad00/agent-bom"

WORKDIR /app

COPY pyproject.toml README.md LICENSE ./
COPY src/ ./src/

RUN pip install --no-cache-dir ".[mcp-server]"

# Create non-root user for least-privilege execution
RUN addgroup --system abom && adduser --system --ingroup abom abom
USER abom

ENV PYTHONUNBUFFERED=1

HEALTHCHECK --interval=60s --timeout=5s --retries=3 \
    CMD agent-bom --version || exit 1

ENTRYPOINT ["agent-bom", "mcp-server"]
